!function(){function e(e,n,t){Q=new AMap.Map("",{}),Q.plugin(["AMap.Geolocation","AMap.Geocoder"],function(){ee=new AMap.Geolocation({noGeoLocation:config.NO_GEO_LOCATION,enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!1}),ae=new AMap.Geocoder({timeout:1e4}),ee.getCurrentPosition(),e?($("#local-address").html("正在定位..."),$(".relocation").find("i").removeClass("icon-gps_location").addClass("icon-gps_loading")):$("#fruitday-loading").show(),AMap.event.addListener(ee,"complete",function(t){return a(t),N=t.addressComponent.building||t.addressComponent.township,P=N,Z={detail_addr:D=t.formattedAddress,province_name:j=t.addressComponent.province,area_name:U=t.addressComponent.district},R=t.addressComponent.adcode,J.adcode=R,t.position.getLng()&&t.position.getLat()?(q=t.position.getLng(),H=t.position.getLat(),J.lonlat=q+","+H,void n(N)):(Tools.showToast("无法获取当前位置",1e3),e?(setTimeout(g(t),1e3),""):(setTimeout(m(t),1e3),""))}),AMap.event.addListener(ee,"error",t)})}function a(e){E=e.addressComponent.city,j=e.addressComponent.province,E?Storage.set("currRegion",E):Storage.set("currRegion",j)}function n(e,a){a=a||4e3,te.slideDown(),te.find("span").html(e),ne=setTimeout(function(){te.slideUp()},a)}function t(e,a,n){Ajax.custom({type:"GET",url:config.HOST_API+"v3/ad/homepage",data:{connect_id:e.connect_id,type:e.type,lonlat:e.lonlat,ad_code:e.adcode,tab_id:W},showLoading:!0},function(n){var r=n.data;if(r.tab.length<=1?$(".home").css("padding-top","43px"):$(".home").css("padding-top","73px"),r.currentAddress.length){var d=r.currentAddress[0];return e.lonlat=d.lonlat,e.adcode=d.area_adcode,W="",f(P=d.address_name),_(d.flag),Z={detail_addr:d.address,province_name:d.province_name,area_name:d.area_name},Storage.set("address_id",d.id),v(2),t(e,function(e){w(e)},function(e,a){$("body").html('<div class="nodata">'+(a&&a.message||"服务器异常。"+e)+"</div>")}),""}return r.otherAddress.length?(Ajax.render("#otherAddress","otherAddress-tmpl",r.otherAddress),$(".other-box").show(),B(r.otherAddress),""):void(r.deliverId&&r.storeId?($(".home-swiper").show(),$("#noArea").hide(),$("#geoFail").hide(),a(n),K=r.tab,$("body").hasClass("isFirstRender")&&(Ajax.render("#arri-time","arri-time-tmpl",r),Ajax.render("#menu-top","menu-top-tmpl",K),Ajax.render("#home-swiper-slide","home-swiper-tmpl",K),b=new Swiper(".menu-swiper",{slidesPerView:4.6,watchSlidesProgress:!0,watchSlidesVisibility:!0,onTap:function(e){F=e.clickedIndex,y.slideTo(e.clickedIndex)}}),y=new Swiper(".home-swiper",{autoplay:!1,onSlideChangeStart:function(a){F=a.activeIndex;var n=$(".menu-swiper .swiper-slide").eq(F),t=a.slides[F];W=n.data("id"),n.hasClass("firstClick")?(e.type=3,Ajax.custom({type:"GET",url:config.HOST_API+"v3/ad/homepage",data:{connect_id:e.connect_id,type:e.type,store_id_list:S,tms_region_type:A,tab_id:W},showLoading:!0},function(e){var a=e.data;o(a),i(F)},function(e,a){i(F),$(t).html('<div class="nodata">'+(a&&a.message||"服务器异常。"+e)+"</div>")})):i(F)},onLazyImageLoad:function(e,a,n){alert("延迟加载图片"),console.log(n)}}),$(".menu-swiper .swiper-slide").eq(F).addClass("active")),$("body").removeClass("isFirstRender"),o(r)):($(".home-swiper").hide(),$("#noArea").show(),$("#geoFail").hide(),b=new Swiper(".menu-swiper",{}),y=new Swiper(".home-swiper",{}),w(n)))},function(e,a){"function"==typeof n&&n(e,a)})}function i(e){F=e,$(".menu-swiper .active").removeClass("active");$(".menu-swiper .swiper-slide").eq(F).addClass("active");b.slideTo(F)}function o(e){var a=[];if(a[F]=e.banner.mainBanners,a[F])for(var n=0;n<a[F].length;n++){var t=a[F][n],i=t.group_type,o=(t.content,"#item-"+F+"-"+n);if($("#home-swiper-slide > .swiper-slide").eq(F).append('<div id="item-'+F+"-"+n+'"></div>'),"iconBanner"!=i&&"newsBanner"!=i){"bigImageBanner"==i&&("normalBanner_v51"==a[F][n+1].group_type,Object.assign(a[F][n+1],{has_radian:1})),"2nBanner_v51"==i&&"2nBanner_v51"!=a[F][n+1].group_type&&Object.assign(t,{has_padding:1}),d(i),Ajax.render(o,V+"-tmpl",t);var c={ROTA_BANNER:2.34375,BRAND:1125/108,PROMO:1125/330,BIG_IMG:2.34375,BIG_IMG_LOW:1005/210,TWO_BANNER:4.375,PLUS_BIG:564/690*2,PLUS_SMALL:564/345*2,IMG_TITLE:5.859375,ROTA_SMALL_BANNER:1.25};r(".rotationBanner",c.ROTA_BANNER),r(".brandBanner",c.BRAND),r(".promotionBanner",c.PROMO),r(".bigImageBanner",c.BIG_IMG),r(".bigImageBannerLow",c.BIG_IMG_LOW),r(".twoBanner",c.TWO_BANNER),r(".plus2Banner .left",c.PLUS_BIG),r(".plus2Banner .right",c.PLUS_SMALL),r(".imageTitleBanner",c.IMG_TITLE);var l={groupType:i,i:n,itemId:o};s(l)}}else $("#home-swiper-slide > .swiper-slide").eq(F).html('<div class="nodata">还未添加数据哦~</div>');$(".menu-swiper").find(".swiper-slide").eq(F).removeClass("firstClick")}function r(e,a){$(e).find("img").height(x/a)}function d(e){switch(e){case"rotationBanner":V="rotationBanner";break;case"newsBanner":V="newsBanner";break;case"iconBanner":V="iconBanner";break;case"titleBanner":V="titleBanner";break;case"bigImageBanner":V="bigImageBanner";break;case"imageTitleBanner":V="imageTitleBanner";break;case"bigImageBannerLow":V="bigImageBannerLow";break;case"rotationSmallBanner":V="rotationSmallBanner";break;case"3perLineBanner":V="3perLineBanner";break;case"2perLineBanner":V="2perLineBanner";break;case"1plus2Banner":V="1plus2Banner";break;case"rotationProBanner":V="rotationProBanner";break;case"proBannerBigImage_v51":V="proBannerBigImage_v51";break;case"2nBanner_v51":V="2nBanner_v51";break;case"normalBanner_v51":V="normalBanner_v51";break;case"rotationSmallBanner_v51":V="rotationSmallBanner_v51";break;case"promotionBanner":V="promotionBanner";break;case"brandBanner":V="brandBanner";break;case"proBannerTagUnderImage":V="proBannerTagUnderImage"}}function s(e){switch(e.groupType){case"rotationBanner":var a=[];a[e.i]=new Swiper(e.itemId+" .swiper-container",{autoplay:3e3,pagination:e.itemId+" .swiper-pagination",paginationClickable:!0,loop:!0});break;case"newsBanner":var n=[];n[e.i]=new Swiper(e.itemId+" .swiper-container",{direction:"vertical",loop:!0,autoplay:4e3,autoplayDisableOnInteraction:!1});break;case"proBannerBigImage_v51":var t=[];t[e.i]=new Swiper(e.itemId+" .swiper-container",{slidesPerView:"auto",freeMode:!0});break;case"rotationSmallBanner_v51":var i=[];i[e.i]=new Swiper(e.itemId+" .swiper-container",{slidesPerView:"auto",freeMode:!0});break;case"proBannerTagUnderImage":var o=[];o[e.i]=new Swiper(e.itemId+" .swiper-container",{slidesPerView:"auto",freeMode:!0})}}function c(){G.show(0,function(){main.getCurrRgn(G),main.changeHeight(G,"#m-address .scroll")}),D?($("#local-address").html(D),$("#nearBy").hasClass("once")&&l()):e(!0,h,g),C&&$("#addrItem").hasClass("firstClick")&&Ajax.custom({type:"GET",url:config.HOST_API+"v3/address/lists",data:{connect_id:C},showLoading:!0},function(e){var a=e.data;B(a),Ajax.render("#addrItem","addrItem-tmpl",a),$("#addrItem").removeClass("firstClick")})}function l(){AMap.service("AMap.PlaceSearch",function(){var e=new AMap.PlaceSearch;$("#nearBy").html('<div class="item">正在搜索附近地址...</div>'),e.searchNearBy("",[q,H],100,function(e,a){if("complete"===e&&"OK"===a.info){for(var n=a.poiList.pois,t=0;t<n.length;t++)Y.lng[t]=n[t].location.lng,Y.lat[t]=n[t].location.lat,Y.address[t]=n[t].address;Ajax.render("#nearBy","nearBy-tmpl",n),$("#nearBy").removeClass("once")}})})}function m(e){J.type=1,C?t(J,function(e){w(e)},function(e,a){$("body").html('<div class="nodata">'+(a&&a.message||"服务器异常。"+e)+"</div>")}):(M.addClass("fail"),L.before('<i class="iconfont icon-address"></i>'),f("定位失败"),$("#geoFail").show(),$(".home-swiper").hide(),$("#noArea").hide())}function p(e){Storage.remove("addr_flag"),f(e),v(0),t(J,function(e){w(e)},function(e,a){$("body").html('<div class="nodata">'+(a&&a.message||"服务器异常。"+e)+"</div>")})}function g(e){$("#local-address").html("定位失败"),$(".relocation").find("i").removeClass("icon-gps_loading").addClass("icon-gps_location"),$("#nearBy").html('<div class="item no-data">无法获取附近地址</div>')}function h(){$("#local-address").html(D),$(".relocation").find("i").removeClass("icon-gps_loading").addClass("icon-gps_location"),l()}function f(e){L.html(e),z&&L.prepend("<span class='tag'>"+z+"</span>"),$(".home-header").css("display","block"),$("#fruitday-loading").hide()}function u(e){var a=$("#goods-search");F=0,W="",b&&y&&(b.slideTo(0,"",!1),y.slideTo(0,"",!1),b.destroy(!0),y.destroy(!0)),$("#arri-time").empty(),$("#menu-top").empty(),$("#home-swiper-slide").empty(),$("body").addClass("isFirstRender"),ne&&(clearTimeout(ne),te.slideUp()),G.hide(),v(2),t(J,function(e){w(e),n("请注意收货地址",4e3)}),M.hasClass("fail")&&(M.removeClass("fail"),L.prev("i").remove()),L.html(P),e?Storage.set("address_id",e):(Storage.remove("addr_flag"),Storage.remove("address_id")),a.length&&a.find(".icon-searchhomedel").trigger("click")}function _(e){e&&(L.prepend("<span class='tag'>"+e+"</span>"),Storage.set("addr_flag",e))}function v(e){Storage.set("local_type",J.type=e),Storage.set("lonlat",J.lonlat),Storage.set("area_adcode",J.adcode),Storage.set("current_addr",P),Storage.set("addAress",Z)}function w(e){var a=e.data;S=a.storeId,k=a.tmsRegionTime,A=a.tmsRegionType,I=a.deliverId,Storage.set("store_id_list",S),Storage.set("tms_region_time",k),Storage.set("tms_region_type",A),Storage.set("delivery_code",I)}function B(e){for(var a=0;a<e.length;a++)X.province_name[a]=e[a].province.name,X.area_name[a]=e[a].area.name,X.address_name[a]=e[a].address_name,X.address[a]=e[a].address,X.adcode[a]=e[a].area_adcode,X.lonlat[a]=e[a].lonlat,e[a].flag&&(X.flag[a]=e[a].flag)}var b,y,S,k,A,I,T=$(".container"),C=Tools._GET().connect_id||Cookie.get("connect_id")||"",x=$(window).width(),O=$(window).height(),L=$("#map"),M=$("header .position"),G=$(".geolocation"),P=Storage.get("current_addr"),R="",N="",j="",E="",U="",D="",q="",H="",F=0,W="",V="",z=Storage.get("addr_flag"),K={},X={province_name:[],area_name:[],address_name:[],address:[],adcode:[],lonlat:[],flag:[]},Y={province_name:[],area_name:[],address:[],lng:[],lat:[]},Z=Storage.get("addAress")||{detail_addr:"",province_name:"",area_name:""},J={connect_id:C,lonlat:Storage.get("lonlat")||",",type:Storage.get("local_type"),adcode:Storage.get("area_adcode")||""};document.referrer.indexOf("m.sm.cn")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=Ogp5nSBZ9q":document.referrer.indexOf("m.baidu.com")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=Oed8oWDXYL":document.referrer.indexOf("m.sogou.com")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=6hApTX86cJ":document.referrer.indexOf("m.so.com")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=LLtOqiDvpf":document.referrer.indexOf("m.google.com")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=WbA8otHvGO":document.referrer.indexOf("m.youdao.com")>0?location.href="http://bi.fruitday.com/static/gather.html?tracking=qYpuKrXDx3":document.referrer.indexOf("m.chinaso.com")>0&&(location.href="http://bi.fruitday.com/static/gather.html?tracking=fZPSGSGtsY"),Tools._GET().connect_id&&Cookie.set("connect_id",C),J.lonlat.split(",")[0]&&J.lonlat.split(",")[1]&&J.adcode&&(0===J.type||2==J.type||3==J.type)&&P?(f(P),t(J,function(e){w(e)},function(e,a){$(".container").html('<div class="nodata">'+(a&&a.msg||"服务器异常。"+e)+"</div>")})):e(!1,p,m);var Q,ee,ae;template.helper("$target",function(e,a,n,t){var t=t?t:"",i=n;switch(e){case"1":i="./main/good-detail.html?product_id="+a+"&store_id="+t;break;case"2":i=i.indexOf("?")>-1?i+"&store_id_list="+S+"&platform=wap&store_id="+t:i+"?store_id_list="+S+"&platform=wap&store_id="+t;break;case"8":i="./main/category.html";break;case"9":i="./main/category-list.html?class2_id=0&class3_id="+a;break;default:i="javascript:;"}return encodeURI(i)}),template.helper("$className",function(e){var a="";switch(e){case"10":a="goToSearch";break;case"12":a="goToTab"}return a}),template.helper("$dataId",function(e,a,n){var t="";switch(e){case"10":t=n;break;default:t=a}return t}),T.on("click",".goToSearch",function(){var e=$(this).data("id");common.gdSearch(function(){common.getProduct(!1,e,!0),$("#searchInput").val(e)})}).on("click",".goToTab",function(){var e=!1;W=$(this).data("id");for(var a=0;a<K.length;a++)if(K[a].id==W){F=a,e=!0;break}e&&(b.slideTo(F),y.slideTo(F))});var ne,te=$("#address-toast");C&&common.countCartNum(),$(window).resize(function(){x=$(window).width(),O=$(window).height(),$("#goods-search .search-tips").css("height",O-57),main.changeHeight(G,"#m-address .scroll")});var ie=navigator.userAgent;ie.indexOf("iPhone")>-1||ie.indexOf("iPad")>-1||ie.indexOf("MicroMessenger")>-1?$(".appdownload").hide():($(".appdownload").slideDown(500),$("header").animate({top:"0.45rem"},500)),$(".close-download").click(function(){$(".appdownload").slideUp(500),$("header").animate({top:"0"},500)}),$(document).on("click","header .position,.location-fail a,.other-box .all-address",function(){c()}),$("#m-address").on("click",".relocation",function(){e(!0,h,g)}),G.on("click","#local-address",function(){var e=$(this).text();return e.indexOf("定位失败")!=-1||e.indexOf("正在定位")!=-1?"":(P=N,J.lonlat=q+","+H,J.adcode=R,Z={detail_addr:D,province_name:j,area_name:U},u(),void 0)}),$(document).on("click","#addrItem .item,.other-box .item",function(e){if($(this).attr("href").indexOf("javascript:;")!=-1){e.preventDefault();var a=$(".other-box"),n=$(this).attr("data-id");if(a.is(":visible")&&a.hide(),$(this).parent().hasClass("other"))t=$(this).index()+3;else var t=$(this).index();P=X.address_name[t],Z={detail_addr:X.address[t],province_name:X.province_name[t],area_name:X.area_name[t]},J.lonlat=X.lonlat[t],J.adcode=X.adcode[t],u(n),_(X.flag[t])}}),G.on("click","#nearBy .item",function(){if($(this).hasClass("no-data"))return"";var e=$(this).index();P=$(this).text(),J.lonlat=Y.lng[e]+","+Y.lat[e],ae.getAddress([Y.lng[e],Y.lat[e]],function(a,n){if("complete"===a&&"OK"===n.info){var t=n.regeocode.addressComponent;Z={detail_addr:Y.address[e],province_name:t.province,area_name:t.district},J.adcode=t.adcode,u()}else Tools.showToast("获取adcode失败,请稍后再试!")})}),$(document).on("click","#addrList li",function(){var e,a,n=$(this).index(),t=main.addrSchlt[n].district;return J.adcode=main.addrSchlt[n].adcode,main.addrSchlt[n].location.lng&&main.addrSchlt[n].location.lat?(J.lonlat=main.addrSchlt[n].location.lng+","+main.addrSchlt[n].location.lat,P=$(this).find("h4").text(),e=t.indexOf("省")!=-1?t.split("省")[0]+"省":t.split("市")[0]+"市",a=t.split("市")[1],Z={detail_addr:main.addrSchlt[n].address,province_name:e,area_name:a},$("#address-search").hide(),u(),void main.setHistory(n)):(Tools.showToast("无法获取当前地址经纬度,请选择详细地址"),"")}),$(".icon-searchhomedel").click(function(){G.hide()});var oe=1;G.on("click",".all-address",function(){oe?($(this).find("span").text("收起").end().find("i").addClass("rotate"),$(".other").slideDown(),oe=0):($(this).find("span").text("展开全部地址").end().find("i").removeClass("rotate"),$(".other").slideUp(),oe=1)}),G.on("click",".searchbar,.near .more",function(){main.addrSearch()}),$("header>.head>.icon-searchpage").on("click",function(e){common.gdSearch()});var re=1;G.on("click",".search-more span",function(){var e=$(this);re?(main.showRegion(e,G,"geoRge"),re=0):(main.hideRegion(e,G),re=1)}),G.on("click",".region-ul .more a",function(){main.openCity($(this))}),G.on("click",'.region-ul>li:not(".more")>a,.list>li>a,.child>li>a',function(){main.choiceCity($(this),G),re=1}),$("#home-swiper-slide").on("click",".icon-searchplus",function(e){e.preventDefault();var a=$(this).parents(".item").attr("data-id");common.addCart({product_id:a})}),$(".swiper-slide").scroll(function(){console.log(2)})}();